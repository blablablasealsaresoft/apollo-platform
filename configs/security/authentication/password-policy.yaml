# Password Policy Configuration for Apollo Platform
# CJIS-compliant password requirements for law enforcement platform

password_policy:
  # Password Length Requirements
  min_length: 16
  max_length: 128

  # Character Requirements
  requirements:
    # Require at least one uppercase letter
    uppercase: true
    uppercase_min: 1

    # Require at least one lowercase letter
    lowercase: true
    lowercase_min: 1

    # Require at least one number
    numbers: true
    numbers_min: 1

    # Require at least one special character
    special_characters: true
    special_characters_min: 1

    # Allowed special characters
    allowed_special_chars: "!@#$%^&*()_+-=[]{}|;:,.<>?"

  # Complexity Requirements
  complexity:
    # Minimum number of different character types required
    min_character_types: 3

    # Prevent common passwords
    no_common_passwords: true

    # Common password dictionary size
    common_password_list_size: 100000

    # Prevent personal information in password
    no_personal_info: true

    # Personal info to check against
    personal_info_checks:
      - email
      - username
      - firstName
      - lastName
      - agency
      - badgeNumber
      - phoneNumber

    # Prevent sequential characters (123, abc, etc.)
    no_sequential_characters: true

    # Maximum allowed sequential characters
    max_sequential: 3

    # Prevent repeated characters (aaa, 111, etc.)
    no_repeated_characters: true

    # Maximum allowed repeated characters
    max_repeated: 3

    # Prevent keyboard patterns (qwerty, asdfgh, etc.)
    no_keyboard_patterns: true

    # Minimum entropy bits (strength measure)
    min_entropy_bits: 50

  # Password Expiry
  expiry:
    # Password maximum age in days
    max_age_days: 90

    # Warning before expiry (days)
    warning_days: 14

    # Force password change on first login
    force_change_first_login: true

    # Force password change after admin reset
    force_change_after_reset: true

    # Grace logins after expiry
    grace_logins: 3

    # Account lockout after grace period
    lockout_after_grace: true

  # Password History
  history:
    # Number of previous passwords to remember
    remember_count: 5

    # Prevent password reuse
    prevent_reuse: true

    # Minimum time before password can be reused
    reuse_after_days: 365

  # Account Lockout Policy
  lockout:
    # Maximum failed login attempts before lockout
    max_attempts: 5

    # Lockout duration
    lockout_duration: 30m

    # Progressive lockout (increase duration with repeated lockouts)
    progressive_lockout: true

    # Progressive lockout durations
    progressive_durations:
      - 30m
      - 1h
      - 4h
      - 24h

    # Reset failed attempts counter after successful login
    reset_after: 24h

    # Notify user of lockout
    notify_user: true

    # Notify security team of repeated lockouts
    notify_security_threshold: 3

    # Allow unlock methods
    unlock_methods:
      - time_based  # Automatic after lockout_duration
      - admin_unlock
      - self_service_email
      - mfa_verification

  # Password Reset
  reset:
    # Password reset link validity
    link_validity: 1h

    # Maximum reset attempts per day
    max_attempts_per_day: 3

    # Require identity verification
    require_identity_verification: true

    # Verification methods
    verification_methods:
      - email
      - mfa
      - security_questions  # Backup only
      - admin_verification

    # Cooldown between reset requests
    cooldown_period: 15m

    # Invalidate old reset links when new one generated
    invalidate_previous_links: true

  # Password Change
  change:
    # Require current password for change
    require_current_password: true

    # Require MFA for password change
    require_mfa: true

    # Cooldown period between password changes
    min_change_interval: 24h

    # Notify user of password change
    notify_user: true

    # Notification methods
    notification_methods:
      - email
      - sms
      - in_app

    # Terminate all sessions after password change
    terminate_sessions: true

    # Revoke all refresh tokens after password change
    revoke_refresh_tokens: true

  # Password Strength Meter
  strength_meter:
    # Enable real-time password strength feedback
    enabled: true

    # Strength levels
    levels:
      - weak
      - fair
      - good
      - strong
      - very_strong

    # Minimum required strength
    min_required_strength: good

    # Show strength score
    show_score: true

    # Show improvement suggestions
    show_suggestions: true

  # Compromised Password Detection
  breach_detection:
    # Check against known breached passwords
    enabled: true

    # Breach detection service
    service: haveibeenpwned

    # API configuration
    api_key: ${HIBP_API_KEY}

    # Check on password creation
    check_on_create: true

    # Check on password change
    check_on_change: true

    # Periodic checks for existing passwords
    periodic_check: true

    # Periodic check interval
    check_interval: 30d

    # Force password change if breached
    force_change_if_breached: true

  # Temporary Passwords
  temporary_passwords:
    # Generate temporary passwords for new users
    enabled: true

    # Temporary password length
    length: 20

    # Temporary password validity
    validity: 24h

    # Force change on first use
    force_change: true

    # Single use only
    single_use: true

    # Character set for temporary passwords
    character_set: alphanumeric_special

  # Password Recovery
  recovery:
    # Enable self-service password recovery
    enabled: true

    # Recovery methods
    methods:
      - email_link
      - mfa_verification
      - backup_codes
      - admin_assistance

    # Require multiple recovery factors
    require_multiple_factors: false

    # Recovery attempt limit
    max_attempts: 3

    # Recovery cooldown after max attempts
    cooldown_after_max: 24h

  # Security Questions (Backup Recovery Only)
  security_questions:
    # Enable security questions (not recommended as primary)
    enabled: false

    # Number of questions to set
    required_count: 3

    # Number of questions to answer for recovery
    answer_count: 2

    # Predefined question set
    questions:
      - "What was your first patrol car number?"
      - "What city was your academy training in?"
      - "What was your first assignment location?"
      - "What is your father's middle name?"
      - "What street did you grow up on?"

    # Case-sensitive answers
    case_sensitive: false

    # Allow question changes
    allow_changes: true

    # Require MFA to change questions
    require_mfa_for_changes: true

  # Password Encryption
  encryption:
    # Hashing algorithm
    algorithm: argon2id

    # Argon2 parameters
    argon2:
      memory_cost: 65536  # 64 MB
      time_cost: 3
      parallelism: 4
      hash_length: 32
      salt_length: 16

    # Bcrypt parameters (fallback)
    bcrypt:
      rounds: 12

    # Automatic algorithm upgrade
    auto_upgrade: true

  # Compliance
  compliance:
    # CJIS password policy compliance
    cjis_compliant: true

    # NIST 800-63B compliance
    nist_compliant: true

    # PCI-DSS password requirements
    pci_dss_compliant: true

    # HIPAA password requirements
    hipaa_compliant: true

  # Monitoring and Alerts
  monitoring:
    # Log password policy violations
    log_violations: true

    # Alert on suspicious password activity
    alerts:
      - multiple_failed_attempts
      - password_spray_attack
      - credential_stuffing
      - compromised_password_used
      - weak_password_forced

    # Alert thresholds
    alert_thresholds:
      failed_attempts: 3
      lockouts_per_day: 2
      reset_requests_per_day: 5

  # Rate Limiting
  rate_limiting:
    # Login attempts per IP
    login_per_ip: 10/hour

    # Password reset requests per IP
    reset_per_ip: 5/hour

    # Password change attempts per user
    change_per_user: 5/hour

  # User Communication
  communication:
    # Send password expiry reminders
    expiry_reminders: true

    # Reminder schedule
    reminder_schedule:
      - 14d
      - 7d
      - 3d
      - 1d

    # Password policy education
    provide_guidance: true

    # Password tips URL
    guidance_url: https://apollo-platform.gov/security/password-tips

  # Development Settings
  development:
    # Relaxed policy for development
    relaxed_policy: ${RELAXED_PASSWORD_POLICY:-false}

    # Minimum length in development
    dev_min_length: 8

    # Disable expiry in development
    disable_expiry: ${DISABLE_PASSWORD_EXPIRY:-false}

    # Disable complexity checks in development
    disable_complexity: false
