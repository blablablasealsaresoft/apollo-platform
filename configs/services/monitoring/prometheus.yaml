global:
  scrape_interval: 15s
  evaluation_interval: 15s
  scrape_timeout: 10s
  external_labels:
    cluster: apollo
    environment: production
    datacenter: primary

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
      - targets:
        - alertmanager:9093
      timeout: 10s
      api_version: v2

# Rule files
rule_files:
  - /etc/prometheus/rules/*.yml
  - /etc/prometheus/alerts/*.yml

# Scrape configurations
scrape_configs:
  # Backend Services
  - job_name: 'apollo-backend'
    metrics_path: /metrics
    static_configs:
      - targets:
        - authentication:4001
        - operations:4002
        - intelligence-fusion:4003
        - redteam-ops:4004
        - notifications:4005
        - alert-orchestration:4006
        - audit-logging:4007
        - evidence-management:4008
        labels:
          group: backend
          tier: core

    relabel_configs:
      - source_labels: [__address__]
        target_label: instance

  # AI Engines
  - job_name: 'apollo-ai'
    metrics_path: /metrics
    static_configs:
      - targets:
        - bugtrace-ai:8001
        - cyberspike-villager:37695
        - criminal-behavior-ai:8002
        - predictive-analytics:8003
        labels:
          group: ai
          tier: intelligence

  # Intelligence Services
  - job_name: 'apollo-intelligence'
    metrics_path: /metrics
    static_configs:
      - targets:
        - osint-engine:5001
        - geoint-engine:5002
        - surveillance:5000
        - blockchain-forensics:6000
        labels:
          group: intelligence
          tier: data

  # Frontend
  - job_name: 'apollo-frontend'
    metrics_path: /metrics
    static_configs:
      - targets:
        - react-console:3000
        labels:
          group: frontend
          tier: presentation

  # Databases
  - job_name: 'databases'
    static_configs:
      - targets:
        - postgres-exporter:9187
        labels:
          database: postgresql
          tier: data

      - targets:
        - redis-exporter:9121
        labels:
          database: redis
          tier: cache

      - targets:
        - neo4j:2004
        labels:
          database: neo4j
          tier: graph

      - targets:
        - elasticsearch:9200
        labels:
          database: elasticsearch
          tier: search

      - targets:
        - mongodb-exporter:9216
        labels:
          database: mongodb
          tier: document

  # Infrastructure
  - job_name: 'node-exporter'
    static_configs:
      - targets:
        - node-exporter:9100
        labels:
          tier: infrastructure

  # Container metrics
  - job_name: 'cadvisor'
    static_configs:
      - targets:
        - cadvisor:8080
        labels:
          tier: infrastructure

  # Kubernetes metrics (if applicable)
  - job_name: 'kubernetes-apiservers'
    kubernetes_sd_configs:
      - role: endpoints
    scheme: https
    tls_config:
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
      - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
        action: keep
        regex: default;kubernetes;https

  # Service discovery via Consul
  - job_name: 'consul-services'
    consul_sd_configs:
      - server: 'consul:8500'
        datacenter: 'dc1'
    relabel_configs:
      - source_labels: [__meta_consul_service]
        target_label: job

# Storage configuration
storage:
  tsdb:
    path: /prometheus/data
    retention:
      time: 30d
      size: 50GB
    wal_compression: true

# Remote write (optional - for long-term storage)
remote_write:
  - url: ${REMOTE_WRITE_URL}
    queue_config:
      capacity: 10000
      max_shards: 50
      min_shards: 1
      max_samples_per_send: 5000
      batch_send_deadline: 5s
      min_backoff: 30ms
      max_backoff: 100ms
