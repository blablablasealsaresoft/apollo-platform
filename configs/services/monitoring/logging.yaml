logging:
  name: apollo-logging
  version: 1.0.0
  description: Centralized logging configuration for Apollo Platform

stack:
  collector: fluentd
  aggregator: loki
  visualization: grafana

fluentd:
  port: 24224
  config_path: /fluentd/etc/fluent.conf

  sources:
    - name: docker_logs
      type: forward
      port: 24224
      bind: 0.0.0.0

    - name: syslog
      type: syslog
      port: 5140
      bind: 0.0.0.0
      tag: system

  filters:
    - name: parser
      type: parser
      key_name: log
      reserve_data: true
      parsers:
        - type: json
          time_key: timestamp
          time_format: '%Y-%m-%dT%H:%M:%S.%L%z'

    - name: kubernetes_metadata
      type: kubernetes_metadata
      enabled: true

  outputs:
    - name: loki
      type: loki
      url: http://loki:3100
      extra_labels:
        env: production
        cluster: apollo

    - name: elasticsearch
      type: elasticsearch
      host: elasticsearch
      port: 9200
      index_name: apollo-logs
      type_name: _doc
      logstash_format: true
      logstash_prefix: apollo

loki:
  server:
    http_listen_port: 3100
    grpc_listen_port: 9096

  auth_enabled: false

  ingester:
    lifecycler:
      address: 127.0.0.1
      ring:
        kvstore:
          store: inmemory
        replication_factor: 1
    chunk_idle_period: 3m
    chunk_retain_period: 1m
    max_chunk_age: 1h

  schema_config:
    configs:
      - from: 2024-01-01
        store: boltdb-shipper
        object_store: filesystem
        schema: v11
        index:
          prefix: apollo_index_
          period: 24h

  storage_config:
    boltdb_shipper:
      active_index_directory: /loki/boltdb-shipper-active
      cache_location: /loki/boltdb-shipper-cache
      shared_store: filesystem
    filesystem:
      directory: /loki/chunks

  compactor:
    working_directory: /loki/compactor
    shared_store: filesystem
    compaction_interval: 10m

  limits_config:
    reject_old_samples: true
    reject_old_samples_max_age: 168h
    ingestion_rate_mb: 10
    ingestion_burst_size_mb: 20
    max_streams_per_user: 10000
    max_query_series: 1000

  chunk_store_config:
    max_look_back_period: 0s

  table_manager:
    retention_deletes_enabled: true
    retention_period: 720h

log_levels:
  services:
    authentication: info
    operations: info
    intelligence-fusion: info
    redteam-ops: info
    notifications: info
    alert-orchestration: info
    audit-logging: info
    evidence-management: info
    bugtrace-ai: info
    cyberspike-villager: info
    criminal-behavior-ai: info
    predictive-analytics: info
    osint-engine: info
    surveillance: info
    blockchain-forensics: info

  components:
    database: warn
    cache: warn
    api: info
    websocket: info

retention:
  hot_logs: 7d
  warm_logs: 30d
  cold_logs: 90d
  archive_logs: 365d

  by_severity:
    debug: 1d
    info: 7d
    warn: 30d
    error: 90d
    critical: 365d

log_format:
  type: json
  timestamp_format: ISO8601
  fields:
    - timestamp
    - level
    - service
    - message
    - trace_id
    - span_id
    - user_id
    - investigation_id
    - error
    - stack_trace

sensitive_fields:
  mask: true
  fields:
    - password
    - api_key
    - token
    - secret
    - credit_card
    - ssn

aggregation:
  enabled: true
  window: 1m
  deduplication: true

  rules:
    - pattern: 'Duplicate log message'
      action: deduplicate
      window: 5m

    - pattern: 'Database connection.*'
      action: sample
      rate: 0.1

alerts:
  error_rate_high:
    threshold: 100/minute
    window: 5m
    severity: warning

  critical_errors:
    pattern: 'level:critical'
    threshold: 1
    severity: critical

  service_down:
    pattern: 'Service.*failed to start'
    threshold: 1
    severity: critical

export:
  enabled: true
  formats:
    - json
    - csv
  max_export_size: 1GB
  async: true
